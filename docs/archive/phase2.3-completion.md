# Phase 2.3 å®Œæˆæ€»ç»“ - Bash æ‰§è¡Œå·¥å…·

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. Bash å·¥å…· - å‘½ä»¤æ‰§è¡Œ

**åŠŸèƒ½ç‰¹æ€§**:
- âœ… å‰å°æ‰§è¡Œï¼ˆåŒæ­¥ï¼‰- ç­‰å¾…å‘½ä»¤å®Œæˆå¹¶è¿”å›ç»“æœ
- âœ… åå°æ‰§è¡Œï¼ˆå¼‚æ­¥ï¼‰- ç«‹å³è¿”å›ä»»åŠ¡ ID
- âœ… è¶…æ—¶æ§åˆ¶ - é˜²æ­¢å‘½ä»¤æ— é™æœŸè¿è¡Œ
- âœ… å·¥ä½œç›®å½•æŒä¹…åŒ– - æ‰€æœ‰å‘½ä»¤åœ¨åŒä¸€å·¥ä½œç›®å½•æ‰§è¡Œ
- âœ… stdout/stderr åˆå¹¶è¾“å‡º - å®æ—¶æ•è·æ‰€æœ‰è¾“å‡º
- âœ… é€€å‡ºç æ£€æµ‹ - åŒºåˆ†æˆåŠŸ/å¤±è´¥

**å‚æ•°**:
```json
{
  "command": "ls -la",           // å¿…éœ€ï¼Œè¦æ‰§è¡Œçš„å‘½ä»¤
  "description": "åˆ—å‡ºæ–‡ä»¶",     // å¯é€‰ï¼Œå‘½ä»¤æè¿°
  "timeout": 120000,             // å¯é€‰ï¼Œè¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
  "run_in_background": false     // å¯é€‰ï¼Œæ˜¯å¦åå°è¿è¡Œ
}
```

**ç¤ºä¾‹è¾“å‡º**:
```
âœ“ å‘½ä»¤æ‰§è¡Œå®Œæˆ (é€€å‡ºç : 0)
å‘½ä»¤: echo 'Hello, World!'

è¾“å‡º:
Hello, World!
```

### 2. TaskOutput å·¥å…· - è·å–åå°ä»»åŠ¡è¾“å‡º

**åŠŸèƒ½ç‰¹æ€§**:
- âœ… é˜»å¡æ¨¡å¼ - ç­‰å¾…ä»»åŠ¡å®Œæˆ
- âœ… éé˜»å¡æ¨¡å¼ - ç«‹å³è¿”å›å½“å‰çŠ¶æ€
- âœ… è¶…æ—¶æ§åˆ¶ - é˜²æ­¢æ— é™ç­‰å¾…
- âœ… ä»»åŠ¡çŠ¶æ€è·Ÿè¸ª - è¿è¡Œä¸­/æˆåŠŸ/å¤±è´¥

**å‚æ•°**:
```json
{
  "task_id": "uuid",    // å¿…éœ€ï¼Œä»»åŠ¡ ID
  "block": true,        // å¯é€‰ï¼Œæ˜¯å¦ç­‰å¾…å®Œæˆ
  "timeout": 120000     // å¯é€‰ï¼Œè¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
}
```

**ç¤ºä¾‹è¾“å‡º**:
```
ä»»åŠ¡å®Œæˆ: âœ“ æˆåŠŸ
é€€å‡ºç : 0

è¾“å‡º:
Step 1
Step 2
Step 3
```

### 3. TaskStop å·¥å…· - åœæ­¢åå°ä»»åŠ¡

**åŠŸèƒ½ç‰¹æ€§**:
- âœ… æ ‡è®°ä»»åŠ¡ä¸ºåœæ­¢çŠ¶æ€
- âœ… ä»»åŠ¡å­˜åœ¨æ€§æ£€æŸ¥

**å‚æ•°**:
```json
{
  "task_id": "uuid"    // å¿…éœ€ï¼Œä»»åŠ¡ ID
}
```

**ç¤ºä¾‹è¾“å‡º**:
```
âœ“ ä»»åŠ¡å·²æ ‡è®°ä¸ºåœæ­¢: uuid
```

## ğŸ§ª æµ‹è¯•è¦†ç›–

### å•å…ƒæµ‹è¯•
- âœ… `test_bash_tool_simple_command` - æµ‹è¯•ç®€å•å‘½ä»¤æ‰§è¡Œ
- âœ… `test_bash_tool_with_timeout` - æµ‹è¯•è¶…æ—¶æ§åˆ¶
- âœ… `test_bash_tool_background` - æµ‹è¯•åå°ä»»åŠ¡

### é›†æˆæµ‹è¯•ç¤ºä¾‹
åˆ›å»ºäº†å®Œæ•´çš„ç¤ºä¾‹ç¨‹åº `examples/bash_tools.rs`ï¼Œæµ‹è¯•ï¼š
1. ç®€å•å‘½ä»¤æ‰§è¡Œ
2. åˆ—å‡ºæ–‡ä»¶
3. ç®¡é“å‘½ä»¤
4. è¶…æ—¶æ§åˆ¶
5. åå°ä»»åŠ¡æ‰§è¡Œ
6. æŸ¥çœ‹åå°ä»»åŠ¡çŠ¶æ€ï¼ˆéé˜»å¡ï¼‰
7. ç­‰å¾…åå°ä»»åŠ¡å®Œæˆï¼ˆé˜»å¡ï¼‰
8. é”™è¯¯å‘½ä»¤å¤„ç†
9. å·¥ä½œç›®å½•éªŒè¯

è¿è¡Œæ–¹å¼ï¼š
```bash
cargo run --example bash_tools --package oxide-tools
```

## ğŸ“Š æŠ€æœ¯å®ç°

### æ¶æ„è®¾è®¡

```
BashTool
    â”œâ”€ execute_foreground() â†’ (output, exit_code)
    â”œâ”€ execute_background() â†’ task_id
    â””â”€ task_manager: Arc<RwLock<HashMap<String, BackgroundTask>>>
        â†“
TaskOutputTool / TaskStopTool
    â””â”€ task_manager (å…±äº«)
```

### å…³é”®ç‰¹æ€§

1. **å¼‚æ­¥æ‰§è¡Œ**
   - ä½¿ç”¨ `tokio::process::Command`
   - éé˜»å¡ I/O
   - å¹¶å‘ä»»åŠ¡ç®¡ç†

2. **è¾“å‡ºæ•è·**
   - ä½¿ç”¨ `tokio::select!` äº¤æ›¿è¯»å– stdout/stderr
   - å®æ—¶åˆå¹¶è¾“å‡º
   - é¿å…æ­»é”

3. **è¶…æ—¶æ§åˆ¶**
   - ä½¿ç”¨ `tokio::time::timeout`
   - å¯é…ç½®è¶…æ—¶æ—¶é—´
   - å‹å¥½çš„é”™è¯¯æç¤º

4. **åå°ä»»åŠ¡ç®¡ç†**
   - UUID ç”Ÿæˆä»»åŠ¡ ID
   - å…±äº«ä»»åŠ¡ç®¡ç†å™¨
   - ä»»åŠ¡çŠ¶æ€è·Ÿè¸ª

## ğŸ“ ä»£ç ç»Ÿè®¡

- **æ–°å¢æ–‡ä»¶**: `crates/oxide-tools/src/exec.rs` (545 è¡Œ)
- **æµ‹è¯•ç”¨ä¾‹**: 3 ä¸ªå•å…ƒæµ‹è¯• + 9 ä¸ªé›†æˆæµ‹è¯•
- **ç¤ºä¾‹ç¨‹åº**: 1 ä¸ªå®Œæ•´ç¤ºä¾‹
- **å·¥å…·æ•°é‡**: 3 ä¸ª (Bash, TaskOutput, TaskStop)

## ğŸ¯ ä¸ Claude Code çš„å¯¹æ¯”

| åŠŸèƒ½ | Oxide | Claude Code |
|------|-------|-------------|
| Bash - å‰å°æ‰§è¡Œ | âœ… | âœ… |
| Bash - åå°æ‰§è¡Œ | âœ… | âœ… |
| Bash - è¶…æ—¶æ§åˆ¶ | âœ… | âœ… |
| Bash - å·¥ä½œç›®å½•æŒä¹…åŒ– | âœ… | âœ… |
| TaskOutput - é˜»å¡æ¨¡å¼ | âœ… | âœ… |
| TaskOutput - éé˜»å¡æ¨¡å¼ | âœ… | âœ… |
| TaskStop - åœæ­¢ä»»åŠ¡ | âœ… | âœ… |

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### åœ¨ä»£ç ä¸­ä½¿ç”¨

```rust
use oxide_tools::{BashTool, TaskOutputTool, Tool};
use serde_json::json;
use std::path::PathBuf;

#[tokio::main]
async fn main() -> anyhow::Result<()> {
    let working_dir = PathBuf::from(".");
    let bash_tool = BashTool::new(working_dir);

    // å‰å°æ‰§è¡Œ
    let result = bash_tool.execute(json!({
        "command": "ls -la"
    })).await?;

    println!("{}", result.content);

    // åå°æ‰§è¡Œ
    let result = bash_tool.execute(json!({
        "command": "sleep 5 && echo 'done'",
        "run_in_background": true
    })).await?;

    // æå–ä»»åŠ¡ ID
    let task_id = extract_task_id(&result.content);

    // ç­‰å¾…ä»»åŠ¡å®Œæˆ
    let task_manager = bash_tool.task_manager();
    let task_output_tool = TaskOutputTool::new(task_manager);

    let result = task_output_tool.execute(json!({
        "task_id": task_id,
        "block": true
    })).await?;

    println!("{}", result.content);

    Ok(())
}
```

### å·¥å…· Schema

æ¯ä¸ªå·¥å…·éƒ½æä¾› JSON Schemaï¼Œå¯ç”¨äºï¼š
- API æ–‡æ¡£ç”Ÿæˆ
- å‚æ•°éªŒè¯
- LLM å·¥å…·è°ƒç”¨

```rust
let schema = bash_tool.schema();
println!("{}", serde_json::to_string_pretty(&schema.parameters)?);
```

## ğŸ¯ ä¸‹ä¸€æ­¥

Phase 2.3 å·²å®Œæˆï¼æ¥ä¸‹æ¥å¯ä»¥ï¼š

1. **Phase 2.4**: å®ç°æœç´¢å·¥å…·
   - Glob - æ–‡ä»¶æ¨¡å¼åŒ¹é…
   - Grep - ä»£ç æœç´¢

2. **Phase 2.5**: å®ç°ç½‘ç»œå·¥å…·
   - WebFetch - ç½‘é¡µè·å–

3. **Phase 3**: é›†æˆåˆ°ä»£ç†ç³»ç»Ÿ
   - å®ç°å·¥å…·è°ƒç”¨å¾ªç¯
   - ä¸ LLM é›†æˆ
   - å®Œæ•´çš„ Agent å·¥ä½œæµ

## ğŸ“š æ–‡æ¡£

- `crates/oxide-tools/src/exec.rs` - æºä»£ç 
- `crates/oxide-tools/examples/bash_tools.rs` - ç¤ºä¾‹ç¨‹åº
- `docs/roadmap.md` - æ›´æ–°äº†è¿›åº¦

## ğŸ¨ æµ‹è¯•è¾“å‡ºç¤ºä¾‹

```
ğŸ§ª æµ‹è¯• Bash æ‰§è¡Œå·¥å…·

ğŸ“ å·¥ä½œç›®å½•: /Users/c.chen/dev/oxide

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âš¡ æµ‹è¯• 1: ç®€å•å‘½ä»¤æ‰§è¡Œ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ“ å‘½ä»¤æ‰§è¡Œå®Œæˆ (é€€å‡ºç : 0)
å‘½ä»¤: echo 'Hello from Bash!'

è¾“å‡º:
Hello from Bash!

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ”„ æµ‹è¯• 5: åå°ä»»åŠ¡æ‰§è¡Œ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ“ åå°ä»»åŠ¡å·²å¯åŠ¨
  ä»»åŠ¡ ID: 7ff47372-3b13-46fe-b882-c95e323a1bf3
  å‘½ä»¤: for i in 1 2 3; do echo "Step $i"; sleep 0.5; done

ä½¿ç”¨ TaskOutput å·¥å…·æŸ¥çœ‹è¾“å‡º

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â³ æµ‹è¯• 7: ç­‰å¾…åå°ä»»åŠ¡å®Œæˆ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ä»»åŠ¡å®Œæˆ: âœ“ æˆåŠŸ
é€€å‡ºç : 0

è¾“å‡º:
Step 1
Step 2
Step 3

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ‰ æ‰€æœ‰æµ‹è¯•å®Œæˆï¼
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

---

**å®Œæˆæ—¶é—´**: 2026-01-30
**çŠ¶æ€**: âœ… Phase 2.3 å®Œæˆ
**è¿›åº¦**: Phase 2 ä» 40% â†’ 60%
