# Oxide å·²å®ç°åŠŸèƒ½æ¸…å•

> æœ€åæ›´æ–°: 2026-01-28
> çŠ¶æ€: æŒç»­æ›´æ–°

æœ¬æ–‡æ¡£è®°å½• Oxide é¡¹ç›®ä¸­å·²å®Œæ•´å®ç°çš„åŠŸèƒ½ç‰¹æ€§ã€‚

---

## ğŸ“Š å·²å®ç°åŠŸèƒ½æ€»è§ˆ

| åŠŸèƒ½æ¨¡å— | å®ç°æ—¶é—´ | ç›¸å…³æ–‡ä»¶ | æµ‹è¯•è¦†ç›– |
|---------|---------|---------|---------|
| **è®¡åˆ’æ¨¡å¼ç³»ç»Ÿ** | 2026-01-28 | src/tools/plan_mode.rs | âœ… å®Œæ•´ |
| **ä»»åŠ¡ç®¡ç†ç³»ç»Ÿ** | 2026-01-28 | src/task/manager.rs, src/tools/task_*.rs | âœ… å®Œæ•´ |

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### 1. è®¡åˆ’æ¨¡å¼ç³»ç»Ÿ (Plan Mode)

**å®ç°æ—¶é—´**: 2026-01-28 (commit: 523b0e0)
**å¯¹æ ‡**: Claude Code EnterPlanMode/ExitPlanMode

#### åŠŸèƒ½æè¿°

è®¡åˆ’æ¨¡å¼ç³»ç»Ÿå…è®¸ Agent åœ¨æ‰§è¡Œå¤æ‚ä»»åŠ¡å‰ï¼Œå…ˆè¿›å…¥è®¡åˆ’æ¨¡å¼è®¾è®¡å®ç°æ–¹æ¡ˆï¼Œå¹¶è¯·æ±‚ç”¨æˆ·æ‰¹å‡†åå†æ‰§è¡Œã€‚è¿™ç¡®ä¿äº† Agent çš„è¡Œä¸ºç¬¦åˆç”¨æˆ·é¢„æœŸï¼Œé¿å…æµªè´¹æ—¶é—´å’Œèµ„æºã€‚

#### æ ¸å¿ƒç»„ä»¶

1. **EnterPlanModeTool** (src/tools/plan_mode.rs:231-333)
   - è¿›å…¥è®¡åˆ’æ¨¡å¼
   - åˆ›å»ºè®¡åˆ’ ID: `plan_YYYYMMDD_HHMMSS`
   - åˆå§‹åŒ–è®¡åˆ’ç›®å½•: `.oxide/plans/`
   - æ˜¾ç¤ºå‹å¥½çš„ç»ˆç«¯ UI

2. **ExitPlanModeTool** (src/tools/plan_mode.rs:374-615)
   - é€€å‡ºè®¡åˆ’æ¨¡å¼å¹¶è¯·æ±‚ç”¨æˆ·æ‰¹å‡†
   - æ˜¾ç¤ºè®¡åˆ’å†…å®¹å’Œæƒé™åˆ—è¡¨
   - ç”¨æˆ·äº¤äº’å¼å®¡æ‰¹ï¼ˆæ‰¹å‡†/ä¿®æ”¹/å–æ¶ˆï¼‰
   - ä¿å­˜è®¡åˆ’åˆ° Markdown æ–‡ä»¶

3. **PlanModeManager** (src/tools/plan_mode.rs:135-199)
   - å…¨å±€çŠ¶æ€ç®¡ç†å™¨ï¼ˆå•ä¾‹æ¨¡å¼ï¼‰
   - ç®¡ç†è®¡åˆ’æ¨¡å¼çŠ¶æ€ï¼ˆactive, approved, plan_contentï¼‰
   - æƒé™éªŒè¯æœºåˆ¶

4. **AllowedPrompt** (src/tools/plan_mode.rs:21-42)
   - æƒé™æè¿°ç»“æ„ï¼ˆtool + promptï¼‰
   - æƒé™åŒ¹é…å’ŒéªŒè¯
   - æ”¯æŒè¯­ä¹‰åŒ–æƒé™æè¿°

#### å®ç°ç‰¹æ€§

##### 1. è®¡åˆ’æ–‡ä»¶ç®¡ç†
- è‡ªåŠ¨ç”Ÿæˆè®¡åˆ’ ID: `plan_YYYYMMDD_HHMMSS`
- ä¿å­˜è·¯å¾„: `.oxide/plans/<plan_id>.md`
- Markdown æ ¼å¼ï¼ŒåŒ…å«ï¼š
  - å…ƒæ•°æ®ï¼ˆç”Ÿæˆæ—¶é—´ã€çŠ¶æ€ï¼‰
  - æƒé™åˆ—è¡¨
  - è®¡åˆ’å†…å®¹

##### 2. ç”¨æˆ·å®¡æ‰¹æµç¨‹
- æ˜¾ç¤ºè®¡åˆ’å†…å®¹ï¼ˆè¶…è¿‡ 2000 å­—ç¬¦è‡ªåŠ¨æˆªæ–­ï¼‰
- æ˜¾ç¤ºéœ€è¦çš„æƒé™åˆ—è¡¨
- ä¸‰é€‰ä¸€äº¤äº’ï¼š
  - âœ… æ‰¹å‡†å¹¶æ‰§è¡Œ
  - âœï¸ ä¿®æ”¹è®¡åˆ’ï¼ˆæ”¯æŒè¾“å…¥ä¿®æ”¹æ„è§ï¼‰
  - âŒ å–æ¶ˆ
- æ‰¹å‡†åä¿ç•™æƒé™çŠ¶æ€ä¾›åç»­éªŒè¯

##### 3. æƒé™ç®¡ç†
- `AllowedPrompt` ç»“æ„ï¼š
  ```rust
  pub struct AllowedPrompt {
      pub tool: String,    // å·¥å…·åç§°ï¼ˆå¦‚ "Bash", "Write"ï¼‰
      pub prompt: String,  // æƒé™æè¿°ï¼ˆå¦‚ "run tests", "install dependencies"ï¼‰
  }
  ```
- æƒé™éªŒè¯æœºåˆ¶ï¼š
  - æ£€æŸ¥å·¥å…·åç§°åŒ¹é…
  - è¯­ä¹‰åŒ–åŒ¹é…æ“ä½œæè¿°
  - æ‰¹å‡†åæ‰å…è®¸æ‰§è¡Œ
- æ‰¹å‡†åä¿ç•™æƒé™çŠ¶æ€

##### 4. å‹å¥½çš„ç»ˆç«¯ UI
- å½©è‰²è¾“å‡ºï¼ˆä½¿ç”¨ `colored` crateï¼‰
- è¡¨æ ¼è¾¹æ¡†å’Œåˆ†éš”çº¿
- æ¸…æ™°çš„çŠ¶æ€æç¤º
- è¿›åº¦åé¦ˆ

#### ä½¿ç”¨ç¤ºä¾‹

```rust
// Agent è‡ªåŠ¨è°ƒç”¨ EnterPlanMode
// ç”¨æˆ·çœ‹åˆ°ï¼š
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    ğŸ“‹ è¿›å…¥è®¡åˆ’æ¨¡å¼                            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

è®¡åˆ’ ID: plan_20260128_143022
è®¡åˆ’æ–‡ä»¶: .oxide/plans/plan_20260128_143022.md

åœ¨è®¡åˆ’æ¨¡å¼ä¸‹ï¼Œä½ å¯ä»¥ï¼š
  â€¢ æ¢ç´¢ä»£ç åº“ï¼Œäº†è§£ç°æœ‰æ¶æ„
  â€¢ è®¾è®¡å®ç°æ–¹æ¡ˆ
  â€¢ ä½¿ç”¨ exit_plan_mode æäº¤è®¡åˆ’å¹¶è¯·æ±‚ç”¨æˆ·æ‰¹å‡†

// Agent è®¾è®¡å®Œæ–¹æ¡ˆåè°ƒç”¨ ExitPlanMode
// ç”¨æˆ·çœ‹åˆ°ï¼š
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    ğŸ“‹ è®¡åˆ’å®¡æ‰¹è¯·æ±‚                            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“ è®¡åˆ’å†…å®¹:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# å®ç°ä»»åŠ¡ç®¡ç†ç³»ç»Ÿ

## ç›®æ ‡
å®Œå–„ä»»åŠ¡ç®¡ç†ç³»ç»Ÿï¼Œæ·»åŠ ä¾èµ–å…³ç³»å’Œå…ƒæ•°æ®æ”¯æŒã€‚

## å®æ–½æ­¥éª¤
1. æ‰©å±• Task æ•°æ®ç»“æ„
2. å®ç°ä¾èµ–å…³ç³»ç®¡ç†
3. æ·»åŠ å•å…ƒæµ‹è¯•
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ğŸ” éœ€è¦çš„æƒé™:
  1. Bash - run tests
  2. Write - create new files
  3. Edit - modify existing files

è¯·é€‰æ‹©æ“ä½œ:
  â¯ æ‰¹å‡†å¹¶æ‰§è¡Œ - Approve and execute the plan
    ä¿®æ”¹è®¡åˆ’ - Request modifications to the plan
    å–æ¶ˆ - Cancel and discard the plan
```

#### é›†æˆçŠ¶æ€

- âœ… å·²é›†æˆåˆ°ä¸» Agent (src/agent/builder.rs:385-386)
- âœ… å·¥å…·å®šä¹‰å®Œæ•´
- âœ… å•å…ƒæµ‹è¯•è¦†ç›–ï¼ˆ8 ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼‰

#### æµ‹è¯•è¦†ç›–

```rust
// src/tools/plan_mode.rs:727-788
#[cfg(test)]
mod tests {
    #[test] fn test_allowed_prompt_creation()
    #[test] fn test_allowed_prompt_matches()
    #[test] fn test_plan_mode_state_default()
    #[test] fn test_plan_mode_state_enter()
    #[test] fn test_plan_mode_state_exit()
    #[test] fn test_plan_mode_state_is_allowed()
}
```

#### ç›¸å…³æ–‡ä»¶

- `src/tools/plan_mode.rs` - å®Œæ•´å®ç°ï¼ˆ789 è¡Œï¼‰
- `src/agent/builder.rs` - å·¥å…·é›†æˆ
- `.oxide/plans/` - è®¡åˆ’æ–‡ä»¶å­˜å‚¨ç›®å½•

#### æŠ€æœ¯äº®ç‚¹

1. **å…¨å±€çŠ¶æ€ç®¡ç†**: ä½¿ç”¨ `Lazy<PlanModeManager>` å®ç°çº¿ç¨‹å®‰å…¨çš„å…¨å±€å•ä¾‹
2. **ç±»å‹å®‰å…¨**: å®Œæ•´çš„ç±»å‹å®šä¹‰å’Œé”™è¯¯å¤„ç†
3. **ç”¨æˆ·ä½“éªŒ**: å‹å¥½çš„ç»ˆç«¯ UI å’Œäº¤äº’æµç¨‹
4. **å¯æµ‹è¯•æ€§**: å®Œæ•´çš„å•å…ƒæµ‹è¯•è¦†ç›–
5. **å¯æ‰©å±•æ€§**: æ”¯æŒè¿œç¨‹ä¼šè¯æ¨é€ï¼ˆé¢„ç•™æ¥å£ï¼‰

#### ä¸ Claude Code çš„å¯¹æ¯”

| ç‰¹æ€§ | Claude Code | Oxide | è¯´æ˜ |
|-----|-------------|-------|------|
| EnterPlanMode | âœ… | âœ… | å®Œå…¨å®ç° |
| ExitPlanMode | âœ… | âœ… | å®Œå…¨å®ç° |
| è®¡åˆ’æ–‡ä»¶ä¿å­˜ | âœ… | âœ… | Markdown æ ¼å¼ |
| æƒé™ç®¡ç† | âœ… | âœ… | AllowedPrompt ç³»ç»Ÿ |
| ç”¨æˆ·å®¡æ‰¹æµç¨‹ | âœ… | âœ… | ä¸‰é€‰ä¸€äº¤äº’ |
| è¿œç¨‹ä¼šè¯æ¨é€ | âœ… | âš ï¸ | æ¥å£é¢„ç•™ï¼Œæœªå®ç° |

#### æœªæ¥æ”¹è¿›æ–¹å‘

- [ ] æ”¯æŒè®¡åˆ’ç‰ˆæœ¬æ§åˆ¶
- [ ] æ”¯æŒè®¡åˆ’æ¨¡æ¿
- [ ] æ”¯æŒè¿œç¨‹ä¼šè¯æ¨é€
- [ ] æ”¯æŒè®¡åˆ’å†å²æŸ¥çœ‹
- [ ] æ”¯æŒè®¡åˆ’å¯¼å‡ºå’Œåˆ†äº«

---

### 2. ä»»åŠ¡ç®¡ç†ç³»ç»Ÿ (Task Management)

**å®ç°æ—¶é—´**: 2026-01-28
**å¯¹æ ‡**: Claude Code TaskCreate/TaskUpdate/TaskList/TaskGet

#### åŠŸèƒ½æè¿°

ä»»åŠ¡ç®¡ç†ç³»ç»Ÿå…è®¸ Agent åˆ›å»ºã€è·Ÿè¸ªå’Œç®¡ç†ç»“æ„åŒ–çš„ä»»åŠ¡åˆ—è¡¨ã€‚æ”¯æŒä»»åŠ¡ä¾èµ–å…³ç³»ã€çŠ¶æ€ç®¡ç†å’Œå…ƒæ•°æ®å­˜å‚¨ï¼Œå¸®åŠ©ç”¨æˆ·å’Œ Agent æ›´å¥½åœ°ç»„ç»‡å¤æ‚çš„å¤šæ­¥éª¤å·¥ä½œã€‚

#### æ ¸å¿ƒç»„ä»¶

1. **TaskManager** (src/task/manager.rs:228-545)
   - å…¨å±€å•ä¾‹æ¨¡å¼
   - ä»»åŠ¡ CRUD æ“ä½œ
   - ä¾èµ–å…³ç³»ç®¡ç†
   - å¾ªç¯ä¾èµ–æ£€æµ‹
   - æŒä¹…åŒ–å­˜å‚¨

2. **TaskCreateTool** (src/tools/task_create.rs)
   - åˆ›å»ºæ–°ä»»åŠ¡
   - æ”¯æŒå…ƒæ•°æ®
   - è‡ªåŠ¨ç”Ÿæˆ UUID

3. **TaskUpdateTool** (src/tools/task_update.rs)
   - æ›´æ–°ä»»åŠ¡çŠ¶æ€
   - ä¿®æ”¹ä»»åŠ¡å±æ€§
   - ç®¡ç†ä¾èµ–å…³ç³»

4. **TaskListTool** (src/tools/task_list.rs)
   - åˆ—å‡ºæ‰€æœ‰ä»»åŠ¡
   - è¿‡æ»¤å·²åˆ é™¤ä»»åŠ¡
   - æ˜¾ç¤ºé˜»å¡çŠ¶æ€

5. **TaskGetTool** (src/tools/task_get.rs)
   - è·å–ä»»åŠ¡è¯¦æƒ…
   - å®Œæ•´çš„ä»»åŠ¡ä¿¡æ¯

#### å®ç°ç‰¹æ€§

##### 1. ä»»åŠ¡çŠ¶æ€ç®¡ç†
```
pending â†’ in_progress â†’ completed
                     â†’ failed
                     â†’ deleted
```

##### 2. ä¾èµ–å…³ç³»
- `blocks`: æœ¬ä»»åŠ¡é˜»å¡çš„å…¶ä»–ä»»åŠ¡
- `blocked_by`: é˜»å¡æœ¬ä»»åŠ¡çš„å…¶ä»–ä»»åŠ¡
- DFS å¾ªç¯ä¾èµ–æ£€æµ‹

##### 3. æŒä¹…åŒ–å­˜å‚¨
- å­˜å‚¨è·¯å¾„: `.oxide/tasks/<task_id>.json`
- JSON æ ¼å¼
- è·¨ä¼šè¯æŒä¹…åŒ–

##### 4. æ•°æ®ç»“æ„
```rust
pub struct Task {
    pub id: TaskId,
    pub subject: String,
    pub description: String,
    pub active_form: Option<String>,
    pub status: TaskStatus,
    pub owner: Option<String>,
    pub blocks: Vec<TaskId>,
    pub blocked_by: Vec<TaskId>,
    pub metadata: HashMap<String, Value>,
    pub created_at: DateTime<Utc>,
    pub updated_at: DateTime<Utc>,
    // ...
}
```

#### é›†æˆçŠ¶æ€

- âœ… å·²é›†æˆåˆ°ä¸» Agent (src/agent/builder.rs)
- âœ… å·¥å…·å®šä¹‰å®Œæ•´
- âœ… å•å…ƒæµ‹è¯•è¦†ç›–ï¼ˆ31 ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼‰

#### æµ‹è¯•è¦†ç›–

```rust
// src/task/manager.rs æµ‹è¯•
#[test] fn test_task_creation()
#[test] fn test_task_with_agent()
#[test] fn test_task_status_transitions()
#[test] fn test_task_deleted_status()
#[test] fn test_task_manager_simple()
#[test] fn test_task_manager_with_agent()
#[test] fn test_task_persistence()
#[test] fn test_task_dependencies()
#[test] fn test_cycle_detection()
#[test] fn test_available_tasks()

// src/tools/task_*.rs æµ‹è¯•
#[test] fn test_task_create_args_deserialization()
#[test] fn test_task_update_args_deserialization()
#[test] fn test_task_list_args_deserialization()
#[test] fn test_task_get_args_deserialization()
// ...
```

#### ç›¸å…³æ–‡ä»¶

- `src/task/manager.rs` - TaskManager å’Œ Task ç»“æ„ä½“
- `src/tools/task_create.rs` - TaskCreate å·¥å…·
- `src/tools/task_update.rs` - TaskUpdate å·¥å…·
- `src/tools/task_list.rs` - TaskList å·¥å…·
- `src/tools/task_get.rs` - TaskGet å·¥å…·
- `.oxide/tasks/` - ä»»åŠ¡å­˜å‚¨ç›®å½•

#### ä¸ Claude Code çš„å¯¹æ¯”

| ç‰¹æ€§ | Claude Code | Oxide | è¯´æ˜ |
|-----|-------------|-------|------|
| TaskCreate | âœ… | âœ… | å®Œå…¨å®ç° |
| TaskUpdate | âœ… | âœ… | å®Œå…¨å®ç° |
| TaskList | âœ… | âœ… | å®Œå…¨å®ç° |
| TaskGet | âœ… | âœ… | å®Œå…¨å®ç° |
| ä»»åŠ¡ä¾èµ– | âœ… | âœ… | blocks/blocked_by |
| å¾ªç¯æ£€æµ‹ | âœ… | âœ… | DFS ç®—æ³• |
| æŒä¹…åŒ– | âœ… | âœ… | JSON æ–‡ä»¶ |
| å…ƒæ•°æ® | âœ… | âœ… | HashMap |

#### è¯¦ç»†æ–‡æ¡£

å®Œæ•´çš„ API æ–‡æ¡£å’Œä½¿ç”¨æŒ‡å—è¯·å‚è€ƒ [ä»»åŠ¡ç®¡ç†ç³»ç»Ÿè¯¦è§£](./TASK_MANAGEMENT.md)ã€‚

---

## ğŸ“ æ›´æ–°æ—¥å¿—

### 2026-01-28
- âœ… å®ç°ä»»åŠ¡ç®¡ç†ç³»ç»Ÿï¼ˆTaskCreate/TaskUpdate/TaskList/TaskGetï¼‰
- âœ… å®ç°ä»»åŠ¡ä¾èµ–å…³ç³»å’Œå¾ªç¯æ£€æµ‹
- âœ… å®ç°è®¡åˆ’æ¨¡å¼ç³»ç»Ÿï¼ˆEnterPlanMode/ExitPlanModeï¼‰
- âœ… å®ç°æƒé™ç®¡ç†ç³»ç»Ÿï¼ˆAllowedPromptï¼‰
- âœ… é›†æˆåˆ°ä¸» Agent
- âœ… æ·»åŠ å®Œæ•´çš„å•å…ƒæµ‹è¯•

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [ä»»åŠ¡ç®¡ç†ç³»ç»Ÿè¯¦è§£](./TASK_MANAGEMENT.md)
- [å¾…å®ç°åŠŸèƒ½æ¸…å•](./TODO_FEATURES.md)
- [åŠŸèƒ½å¯¹æ¯”æ€»è§ˆ](./CLAUDE_CODE_COMPARISON.md)
- [æ¶æ„æ–‡æ¡£](./architecture.md)
- [å·¥å…·ç³»ç»Ÿè¯¦è§£](./tool-system.md)
