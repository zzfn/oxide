## ADDED Requirements

### Requirement: 文件上下文引用
CLI SHALL 支持 `@文件路径` 语法来引用文件内容，系统自动读取并注入到对话上下文中。

#### Scenario: 单个文件引用
- **WHEN** 用户输入包含 `@文件路径`（如 `@src/main.rs 请解释这个文件`）
- **THEN** 系统读取文件内容
- **AND** 显示文件引用信息（路径、大小、行数）
- **AND** 将文件内容注入到对话上下文
- **AND** 发送完整消息给 AI

#### Scenario: 多个文件引用
- **WHEN** 用户输入包含多个 `@文件路径`（如 `@src/main.rs @config.toml 比较这两个文件`）
- **THEN** 系统读取所有引用的文件
- **AND** 显示所有文件引用信息列表
- **AND** 将所有文件内容注入到对话上下文
- **AND** 发送完整消息给 AI

#### Scenario: 文件路径自动补全
- **WHEN** 用户输入 `@` 并按 Tab 键
- **THEN** 显示当前目录下的文件和目录列表
- **AND** 支持路径递归补全（如 `@src/` 显示 src 目录下的内容）
- **AND** 用户可以通过 Tab 或方向键选择补全项

#### Scenario: 文件不存在
- **WHEN** 用户引用的文件路径不存在
- **THEN** 显示清晰的错误提示
- **AND** 指出文件未找到
- **AND** 询问用户是否继续发送消息

#### Scenario: 文件过大警告
- **WHEN** 引用的文件大小超过 1MB
- **THEN** 显示警告信息
- **AND** 询问用户是否确认发送
- **AND** 如果用户确认，则继续发送

#### Scenario: 空文件
- **WHEN** 引用的文件为空（0 字节）
- **THEN** 显示警告信息
- **AND** 指出文件为空
- **AND** 询问用户是否继续

### Requirement: 文件引用解析规则
CLI SHALL 遵循明确的文件引用解析规则，确保一致性和可预测性。

#### Scenario: 基本路径解析
- **WHEN** 用户输入 `@文件名` 或 `@相对路径/文件名` 或 `@/绝对路径`
- **THEN** 系统正确解析路径
- **AND** 支持相对路径（相对于当前工作目录）
- **AND** 支持绝对路径

#### Scenario: 路径中的空格
- **WHEN** 文件路径包含空格（如 `@my file.txt`）
- **THEN** 系统正确识别完整的文件路径
- **AND** 支持引号包裹（如 `@"my file.txt"`，可选）

#### Scenario: 与普通文本混合
- **WHEN** 用户输入包含 `@` 但不是文件引用（如 `email@example.com`）
- **THEN** 系统不将其视为文件引用
- **AND** 规则：`@` 后跟路径分隔符（`/` 或 `\`）才是文件引用

### Requirement: 文件引用可视化
CLI SHALL 提供清晰的视觉反馈，显示已引用的文件信息。

#### Scenario: 显示引用信息
- **WHEN** 用户发送包含文件引用的消息
- **THEN** 在消息发送前显示文件引用列表
- **AND** 每个文件显示：路径、大小、行数
- **AND** 使用图标和颜色增强可读性（如 `📎 src/main.rs (1234 bytes, 42 lines)`）

#### Scenario: 加载状态指示
- **WHEN** 系统正在读取文件内容
- **THEN** 显示加载指示器
- **AND** 在读取完成后立即清除
