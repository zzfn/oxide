# Change: 现代化 TUI 体验 - 任务列表

## 阶段 0: 清理和准备
- [x] 移除 `--no-tui` 参数解析逻辑
- [x] 移除非 TUI 模式的所有代码
- [x] 简化配置系统，移除 UI 模式相关配置
- [x] 清理过时的文档和注释

## 阶段 1: 研究和设计
- [x] 研究现代化 TUI 工具设计模式（Claude Code, Warp, Lazygit）
- [x] 创建详细的设计文档（`docs/tui-redesign.md`）
- [x] 更新 OpenSpec proposal 和 design 文档
- [x] 评审设计方案并收集反馈

## 阶段 2: 界面简化
- [x] 移除所有外边框（Borders::ALL）
- [x] 简化状态栏设计，去除装饰性边框
- [x] 重新设计消息历史区域的布局
- [x] 简化输入框设计，保持简洁
- [x] 更新欢迎界面，采用新的设计风格

## 阶段 3: 流式 Markdown 渲染
- [ ] 实现增量 Markdown 解析器
- [x] 创建流式渲染状态管理
- [x] 实现打字机效果（typewriter effect）
- [x] 集成流式渲染到消息显示系统
- [x] 添加流式渲染的配置选项

## 阶段 4: 工具状态展示改进
- [x] 重新设计工具状态面板的 UI
- [x] 实现实时进度指示器
- [x] 添加加载动画和状态颜色
- [x] 实现工具执行日志的详细显示
- [x] 优化工具状态更新频率

## 阶段 5: 交互体验优化
- [x] 实现双缓冲渲染以消除闪烁
- [x] 优化增量渲染逻辑
- [x] 实现平滑滚动功能
- [x] 优化重绘频率
- [x] 添加键盘快捷键改进

## 阶段 6: 主题系统实现
- [ ] 创建 `src/tui/theme.rs` 模块
- [ ] 实现 `Theme` 结构和内置主题（dark/light/high_contrast）
- [ ] 添加 `toml` 依赖用于配置文件解析
- [ ] 实现主题配置文件加载（`~/.config/oxide/theme.toml`）
- [ ] 重构所有渲染函数使用主题颜色
- [ ] 实现主题热切换（无需重启）
- [ ] 添加主题命令：`/theme list/set/load`

## 阶段 7: 消息卡片和布局模式
- [x] 实现消息卡片设计（`╭─╮│╰─╯` 轻量边框）
- [x] 创建 `LayoutMode` 枚举（Standard/Compact/Minimal/Split）
- [x] 内嵌工具状态到 Assistant 消息中
- [x] 实现不同布局模式的渲染逻辑
- [x] 添加布局模式切换快捷键（`M` 键）
- [x] 更新工具面板支持常驻/按需模式（Split 模式）

## 阶段 8: 交互功能增强
- [ ] 实现快捷键帮助屏幕（`?` 键显示）
- [ ] 创建 `InputHistory` 结构管理命令历史
- [ ] 实现上下键浏览历史（`↑/↓`）
- [ ] 实现历史搜索功能（`Ctrl+R`）
- [ ] 实现多行输入模式（`Ctrl+G` 进入）
- [ ] 实现消息内容搜索（`/` 键）
- [ ] 添加 `n/N` 快捷键跳转搜索结果

## 阶段 9: 性能优化
- [ ] 实现虚拟滚动（虚拟化长列表）
- [ ] 添加渲染缓存机制
- [ ] 实现增量渲染（只重绘脏区域）
- [ ] 限制消息历史大小
- [ ] 添加性能监控和日志

## 阶段 10: 测试和文档
- [ ] 编写单元测试（渲染逻辑、状态管理）
- [ ] 编写集成测试（完整的用户流程）
- [ ] 进行手动测试和用户体验验证
- [ ] 更新用户文档和帮助信息
- [ ] 添加主题配置示例文件
- [ ] 创建主题切换使用指南

## 阶段 11: 发布和监控
- [ ] 创建 pull request
- [ ] 代码审查
- [ ] 合并到主分支
- [ ] 发布新版本（BREAKING CHANGE）
- [ ] 更新 CHANGELOG 说明破坏性变更
- [ ] 监控用户反馈和性能指标

## 验证标准

每个阶段完成后需要验证：
- 功能正常工作，无回归
- 性能指标满足预期（渲染时间 < 100ms）
- 用户体验流畅，无卡顿或闪烁
- 代码符合项目规范
- 测试覆盖充分

## 依赖关系

- 阶段 2-5 可以部分并行进行
- 阶段 6 需要在阶段 2-5 完成后进行
- 阶段 7 依赖于所有功能开发完成
- 阶段 8 依赖于阶段 7 完成
