# tui Spec Delta

## ADDED Requirements

### Requirement: 简洁的界面设计
TUI SHALL 采用简洁现代的界面设计，避免过度装饰。

#### Scenario: 无边框布局
- **WHEN** TUI 初始化完成
- **THEN** 不使用外边框（Borders::ALL）
- **AND** 使用简洁的分隔线（`═════════════════`）
- **AND** 保持足够的留白和间距
- **AND** 专注于内容展示而非装饰

#### Scenario: 简化的状态栏
- **WHEN** 显示状态栏信息
- **THEN** 使用单行文本显示关键信息（版本、模型、会话 ID）
- **AND** 使用简短的状态指示器（✓ 就绪、⟳ 处理中、✗ 错误）
- **AND** 避免冗余的装饰元素

### Requirement: 流式交互体验
TUI SHALL 提供流畅的流式交互体验。

#### Scenario: 打字机效果
- **WHEN** AI 流式输出响应
- **THEN** 实现打字机效果逐字符显示
- **AND** 保持稳定的渲染速度（如 50ms/字符）
- **AND** 可配置打字速度或禁用效果

#### Scenario: 平滑滚动
- **WHEN** 用户滚动消息历史
- **THEN** 实现平滑滚动效果
- **AND** 支持逐行滚动和页面滚动
- **AND** 避免闪烁和跳跃

### Requirement: 增量渲染
TUI SHALL 支持增量渲染以优化性能和用户体验。

#### Scenario: 部分区域更新
- **WHEN** 只有部分内容发生变化
- **THEN** 只重新渲染变化的部分区域
- **AND** 避免不必要的全屏重绘
- **AND** 减少渲染开销

#### Scenario: 双缓冲渲染
- **WHEN** 渲染 TUI 界面
- **THEN** 使用双缓冲技术避免闪烁
- **AND** 在后台缓冲区构建完整帧
- **AND** 一次性更新到终端

### Requirement: 改进的工具状态展示
TUI SHALL 提供清晰直观的工具执行状态展示。

#### Scenario: 实时进度指示
- **WHEN** 工具正在执行
- **THEN** 显示实时进度条或加载动画
- **AND** 显示执行时间预估
- **AND** 使用动画效果增强视觉反馈

#### Scenario: 工具状态详情
- **WHEN** 查看工具执行状态
- **THEN** 显示工具名称和状态（⚡ 执行中、✓ 完成、✗ 失败）
- **AND** 显示工具执行的详细日志
- **AND** 使用颜色区分不同状态

#### Scenario: 多工具执行跟踪
- **WHEN** 多个工具同时执行
- **THEN** 显示每个工具的独立状态
- **AND** 显示整体进度（如 2/5 完成）
- **AND** 支持展开/折叠详细信息

### Requirement: 性能优化
TUI SHALL 通过多种技术优化性能。

#### Scenario: 虚拟滚动
- **WHEN** 消息历史超过一定长度（如 1000 行）
- **THEN** 实现虚拟滚动，只渲染可见区域
- **AND** 保持滚动位置平滑
- **AND** 避免内存溢出

#### Scenario: 渲染缓存
- **WHEN** 渲染相同或相似内容
- **THEN** 使用缓存机制避免重复计算
- **AND** 缓存解析后的 Markdown AST
- **AND** 缓存渲染后的行数据

#### Scenario: 异步渲染
- **WHEN** 进行复杂的渲染操作
- **THEN** 在后台线程异步执行
- **AND** 不阻塞用户输入和交互
- **AND** 使用消息传递更新 UI

## MODIFIED Requirements

### Requirement: TUI 界面初始化（更新）
系统 SHALL 在启动时初始化 TUI 终端界面，采用简洁现代的设计风格。

#### Scenario: TUI 模式启动（更新）
- **WHEN** 用户执行 `oxide` 命令
- **THEN** 初始化 TUI 终端界面
- **AND** 显示简洁的欢迎界面（无边框设计）
- **AND** 显示主布局（状态栏、消息区、输入区）- 采用简洁设计
- **AND** 进入事件循环等待用户输入
- **AND** 不支持非 TUI 模式或 `--no-tui` 参数

### Requirement: 多面板布局（更新）
系统 SHALL 提供简洁的分面板 TUI 布局，避免过度装饰。

#### Scenario: 主布局显示（更新）
- **WHEN** TUI 初始化完成
- **THEN** 顶部显示简洁的状态栏（当前模型、消息计数）- 无边框
- **AND** 中间区域显示消息历史（可滚动）- 无边框
- **AND** 底部显示输入框和提示符 - 无边框
- **AND** 右侧（可选）显示改进的工具调用状态

### Requirement: 消息渲染（更新）
系统 SHALL 以流畅的流式方式渲染各类消息，支持打字机效果和增量更新。

#### Scenario: AI 文本响应渲染（更新）
- **WHEN** 显示 AI 的文本响应
- **THEN** 使用青色显示 AI 消息
- **AND** 流式渲染 Markdown 基本格式（标题、列表、代码块）
- **AND** 实现打字机效果逐字符显示
- **AND** 保持段落间距和格式
- **AND** 渲染过程流畅无卡顿

#### Scenario: 工具调用显示（更新）
- **WHEN** AI 调用工具
- **THEN** 使用黄色显示工具名称
- **AND** 显示工具参数摘要
- **AND** 显示改进的执行状态（带动画的执行中、✓ 完成、✗ 失败）
- **AND** 提供实时进度反馈
- **WHEN** AI 调用工具
- **THEN** 使用黄色显示工具名称
- **AND** 显示工具参数摘要
- **AND** 显示改进的执行状态（带动画的执行中、✓ 完成、✗ 失败）
- **AND** 提供实时进度反馈

### Requirement: 实时状态指示（更新）
系统 SHALL 显示简洁清晰的实时操作状态，提供流畅的视觉反馈。

#### Scenario: API 请求中状态（更新）
- **WHEN** 发送 API 请求
- **THEN** 在状态栏显示简洁的"⟳ 处理中..."提示
- **AND** 使用平滑的加载动画
- **AND** 请求完成后移除提示

#### Scenario: 工具执行状态（更新）
- **WHEN** 执行工具调用
- **THEN** 显示工具执行进度（带进度条或动画）
- **AND** 区分执行中（⚡ 动画）、成功（✓ 绿色）、失败（✗ 红色）状态
- **AND** 使用不同颜色和动画标识状态
- **AND** 提供详细的执行日志
- **WHEN** 执行工具调用
- **THEN** 显示工具执行进度（带进度条或动画）
- **AND** 区分执行中（⚡ 动画）、成功（✓ 绿色）、失败（✗ 红色）状态
- **AND** 使用不同颜色和动画标识状态
- **AND** 提供详细的执行日志

## REMOVED Requirements

### Requirement: 非 TUI 模式支持（已移除）
系统不再支持非 TUI 模式，TUI 是唯一的用户界面。

#### Scenario: 非 TUI 模式启动（已移除）
- **REMOVED**: 不再支持 `oxide --no-tui` 命令
- **REMOVED**: 移除简单终端模式的所有相关代码
- **REMOVED**: 移除非 TUI 模式的交互逻辑
