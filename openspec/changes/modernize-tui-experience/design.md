# Design: ç°ä»£åŒ– TUI ä½“éªŒ

## è®¾è®¡åŸåˆ™

åŸºäº Claude Code çš„è®¾è®¡ç†å¿µï¼Œæˆ‘ä»¬é‡‡ç”¨ä»¥ä¸‹æ ¸å¿ƒåŸåˆ™ï¼š

1. **ç®€æ´ä¼˜å…ˆ**ï¼šå»é™¤ä¸å¿…è¦çš„è£…é¥°å…ƒç´ ï¼Œä¸“æ³¨äºå†…å®¹å±•ç¤º
2. **æµå¼äº¤äº’**ï¼šå®æ—¶æ¸²æŸ“ AI å“åº”ï¼Œæä¾›æµç•…çš„æ‰“å­—æ•ˆæœ
3. **æ¸…æ™°åé¦ˆ**ï¼šå·¥å…·çŠ¶æ€å’Œè¿›åº¦è¦æœ‰æ˜ç¡®çš„è§†è§‰æŒ‡ç¤º
4. **æµç•…ä½“éªŒ**ï¼šæ¶ˆé™¤é—ªçƒï¼Œå¹³æ»‘æ»šåŠ¨ï¼Œå“åº”è¿…é€Ÿ

## ç•Œé¢å¸ƒå±€

### å½“å‰å¸ƒå±€ï¼ˆéœ€è¦ç®€åŒ–ï¼‰
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  çŠ¶æ€æ ï¼ˆå¸¦è¾¹æ¡†ï¼‰                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚  æ¶ˆæ¯å†å²åŒºåŸŸï¼ˆå¸¦è¾¹æ¡†ï¼‰                                â”‚
â”‚                                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è¾“å…¥æ¡†ï¼ˆå¸¦è¾¹æ¡†ï¼‰                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ–°å¸ƒå±€ï¼ˆç®€åŒ–è®¾è®¡ï¼‰
```
Oxide v1.0.0 | deepseek-chat | session-abc123
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ‘¤ ä½ 
Hello, how are you?

ğŸ¤– AI
I'm doing well, thank you for asking!

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’¬ è¾“å…¥: _
```

## æ ¸å¿ƒæ”¹è¿›

### 1. æµå¼ Markdown æ¸²æŸ“

**é—®é¢˜**ï¼šå½“å‰å®ç°ç­‰å¾…å®Œæ•´ AI å“åº”åæ‰æ¸²æŸ“ Markdownï¼Œç”¨æˆ·ç­‰å¾…æ—¶é—´è¿‡é•¿ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
- å®ç°å¢é‡ Markdown è§£æå™¨
- éšç€æµå¼è¾“å…¥å®æ—¶æ›´æ–°æ¸²æŸ“
- æ‰“å­—æœºæ•ˆæœï¼ˆtypewriter effectï¼‰é€å­—ç¬¦æ˜¾ç¤º

**æŠ€æœ¯å®ç°**ï¼š
```rust
// ä¼ªä»£ç ç¤ºä¾‹
struct StreamingMarkdownRenderer {
    buffer: String,
    partial_ast: MarkdownAST,
}

impl StreamingMarkdownRenderer {
    fn append_chunk(&mut self, chunk: &str) -> RenderedLines {
        self.buffer.push_str(chunk);
        self.partial_ast = parse_partial(&self.buffer);
        self.render_to_lines(&self.partial_ast)
    }
}
```

### 2. ç®€åŒ–ç•Œé¢è®¾è®¡

**ç§»é™¤å…ƒç´ **ï¼š
- æ‰€æœ‰å¤–è¾¹æ¡†ï¼ˆBorders::ALLï¼‰
- åˆ†å‰²çº¿ï¼ˆ`â”€` é‡å¤å­—ç¬¦ï¼‰
- è¿‡å¤šçš„è£…é¥°æ€§å›¾æ ‡å’Œç¬¦å·

**ä¿ç•™å…ƒç´ **ï¼š
- æ¶ˆæ¯ç±»å‹æ ‡è¯†ï¼ˆğŸ‘¤ ç”¨æˆ·ã€ğŸ¤– AIã€ğŸ”§ å·¥å…·ï¼‰
- å¿…è¦çš„é—´è·å’Œåˆ†éš”
- çŠ¶æ€æŒ‡ç¤ºå™¨ï¼ˆâœ“ã€âŸ³ã€âœ—ï¼‰

**æ–°å¢å…ƒç´ **ï¼š
- ç®€æ´çš„åˆ†éš”çº¿ï¼ˆå•è¡Œ `â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•`ï¼‰
- ç»†è…»çš„æ¸å˜æˆ–é˜´å½±æ•ˆæœï¼ˆå¦‚æœ terminal æ”¯æŒï¼‰

### 3. æ›´å¥½çš„å·¥å…·çŠ¶æ€å±•ç¤º

**å½“å‰é—®é¢˜**ï¼šå·¥å…·çŠ¶æ€ä¿¡æ¯ä¸å¤Ÿç›´è§‚ï¼Œæ›´æ–°ä¸åŠæ—¶ã€‚

**æ–°è®¾è®¡**ï¼š
- å®æ—¶è¿›åº¦æ¡æˆ–åŠ è½½åŠ¨ç”»
- æ¸…æ™°çš„çŠ¶æ€é¢œè‰²ï¼ˆæ‰§è¡Œä¸­é»„è‰²ã€æˆåŠŸç»¿è‰²ã€å¤±è´¥çº¢è‰²ï¼‰
- å·¥å…·æ‰§è¡Œçš„è¯¦ç»†æ—¥å¿—è¾“å‡º

**å®ç°ç¤ºä¾‹**ï¼š
```
ğŸ”§ å·¥å…·æ‰§è¡Œ
  â”œâ”€ read_file [âš¡ æ‰§è¡Œä¸­...]
  â”œâ”€ grep_search [âœ“ å®Œæˆ]
  â””â”€ write_file [âŸ³ ç­‰å¾…ä¸­]

è¿›åº¦: 1/3 å®Œæˆ | é¢„è®¡å‰©ä½™: 2s
```

### 4. æµç•…çš„äº¤äº’ä½“éªŒ

**é—®é¢˜**ï¼šå½“å‰å®ç°å­˜åœ¨è½»å¾®é—ªçƒï¼Œæ»šåŠ¨ä¸å¤Ÿå¹³æ»‘ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. **åŒç¼“å†²æ¸²æŸ“**ï¼šä½¿ç”¨ ratatui çš„å†…ç½®åŒç¼“å†²æœºåˆ¶
2. **å¢é‡æ›´æ–°**ï¼šåªé‡æ–°æ¸²æŸ“å˜åŒ–çš„éƒ¨åˆ†ï¼Œè€Œéæ•´ä¸ªç•Œé¢
3. **ä¼˜åŒ–æ»šåŠ¨é€»è¾‘**ï¼šå®ç°å¹³æ»‘æ»šåŠ¨ï¼Œæ”¯æŒé€è¡Œæ»šåŠ¨
4. **å‡å°‘é‡ç»˜é¢‘ç‡**ï¼šåœ¨æµå¼æ¸²æŸ“æ—¶æ§åˆ¶é‡ç»˜é¢‘ç‡

**æŠ€æœ¯ç»†èŠ‚**ï¼š
```rust
// å¢é‡æ¸²æŸ“ç¤ºä¾‹
impl TUI {
    fn render_incremental(&mut self, changed_region: Option<Rect>) {
        if let Some(region) = changed_region {
            frame.set_cursor(0, region.y);
            self.render_region(frame, region);
        } else {
            self.render_full(frame);
        }
    }
}
```

## çŠ¶æ€ç®¡ç†

### æ–°å¢çŠ¶æ€ç±»å‹

```rust
pub enum StreamingState {
    Idle,
    Streaming,
    Paused,
    Complete,
}

pub struct MessageRenderer {
    state: StreamingState,
    rendered_lines: Vec<Line>,
    cursor_position: usize,
    markdown_parser: IncrementalParser,
}
```

### å·¥å…·æ‰§è¡ŒçŠ¶æ€è·Ÿè¸ª

```rust
pub struct ToolExecution {
    name: String,
    status: ToolStatus,
    progress: f32,
    started_at: Instant,
    logs: Vec<String>,
}

pub enum ToolStatus {
    Pending,
    Running,
    Completed,
    Failed(String),
}
```

## æ€§èƒ½è€ƒè™‘

1. **æ¸²æŸ“ä¼˜åŒ–**ï¼š
   - é™åˆ¶æœ€å¤§æ¸²æŸ“è¡Œæ•°ï¼ˆå¦‚ 1000 è¡Œï¼‰ï¼Œè¶…å‡ºéƒ¨åˆ†è™šæ‹Ÿæ»šåŠ¨
   - ä½¿ç”¨ç¼“å­˜æœºåˆ¶é¿å…é‡å¤è§£æ
   - å¼‚æ­¥æ¸²æŸ“ä»¥é˜»å¡ä¸»çº¿ç¨‹

2. **å†…å­˜ç®¡ç†**ï¼š
   - é™åˆ¶æ¶ˆæ¯å†å²å¤§å°ï¼ˆå¦‚æœ€è¿‘ 100 æ¡ï¼‰
   - å®ç°æ¶ˆæ¯åˆ†é¡µæˆ–æ‡’åŠ è½½
   - å®šæœŸæ¸…ç†æ—§çš„å·¥å…·çŠ¶æ€

## å‘åå…¼å®¹

**æ­¤å˜æ›´ä¸ä¿æŒå‘åå…¼å®¹ï¼Œä¼šç ´åä»¥ä¸‹å†…å®¹ï¼š**
- ç§»é™¤é TUI æ¨¡å¼ï¼ˆ`--no-tui` å‚æ•°ï¼‰
- ç§»é™¤ç®€å•ç»ˆç«¯æ¨¡å¼
- TUI æˆä¸ºå”¯ä¸€çš„ç”¨æˆ·ç•Œé¢
- æ‰€æœ‰äº¤äº’å¿…é¡»åœ¨æ”¯æŒ TUI çš„ç»ˆç«¯ä¸­è¿è¡Œ

## ç®€åŒ–è®¾è®¡

- **å•ä¸€ UI æ¨¡å¼**ï¼šåªæä¾›ç°ä»£åŒ– TUIï¼Œä¸æ”¯æŒæ¨¡å¼åˆ‡æ¢
- **ç®€åŒ–é…ç½®**ï¼šç§»é™¤ UI æ¨¡å¼ç›¸å…³é…ç½®é€‰é¡¹
- **ä¸“æ³¨ä½“éªŒ**ï¼šæ‰€æœ‰å¼€å‘èµ„æºæŠ•å…¥åˆ°ä¼˜åŒ– TUI ä½“éªŒ

## æœªæ¥æ‰©å±•

1. **ä¸»é¢˜ç³»ç»Ÿ**ï¼šæ”¯æŒç”¨æˆ·è‡ªå®šä¹‰é¢œè‰²æ–¹æ¡ˆå’Œæ ·å¼
2. **æ’ä»¶ç³»ç»Ÿ**ï¼šå…è®¸ç¬¬ä¸‰æ–¹æ‰©å±• UI ç»„ä»¶
3. **å¤šçª—å£å¸ƒå±€**ï¼šæ”¯æŒåˆ†å‰²çª—å£æŸ¥çœ‹ä¸åŒå†…å®¹
4. **å†…ç½®ä»£ç ç¼–è¾‘å™¨**ï¼šåœ¨ TUI ä¸­ç›´æ¥ç¼–è¾‘ä»£ç 
